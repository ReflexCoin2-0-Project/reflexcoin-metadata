<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>RFX2 Community Spin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  margin: 0;
  font-family: Inter, Arial, sans-serif;
  background: radial-gradient(circle at top, #0b1220, #050914);
  color: #fff;
}

.container {
  max-width: 1300px;
  margin: auto;
  padding: 40px;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 30px;
}

.card {
  background: linear-gradient(180deg,#0f1a30,#0a1224);
  border-radius: 18px;
  padding: 30px;
}

h1,h2 {
  color: #f6c400;
}

ul {
  padding-left: 18px;
}

.logo-box {
  background:#fff;
  border-radius:16px;
  padding:25px;
  text-align:center;
}

.logo-box img {
  max-width:120px;
}

.button {
  background:#f6c400;
  color:#000;
  padding:12px 18px;
  border:none;
  border-radius:30px;
  font-weight:700;
  cursor:pointer;
  margin-top:10px;
}

.button:disabled {
  opacity:.4;
}

.center {
  text-align:center;
}

canvas {
  display:block;
  margin:20px auto;
}

input {
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-top:10px;
}

.result {
  margin-top:10px;
  font-size:18px;
}
.small {
  opacity:.7;
  font-size:13px;
}
</style>
</head>

<body>

<div class="container">

  <!-- LEFT -->
  <div class="card">
    <h1>ðŸŽ¡ RFX2 Community Spin</h1>
    <p>
      This is a community-driven experiment built around emotion,
      participation and on-chain culture.
    </p>
    <ul>
      <li>1 spin every 6 hours</li>
      <li>ðŸ’Ž Airdrop slice = real reward</li>
      <li>Wallet required for eligibility</li>
    </ul>
    <p class="small">
      No payments. No guarantees. Experimental only.
    </p>
  </div>

  <!-- CENTER -->
  <div class="card center">
    <canvas id="wheel" width="360" height="360"></canvas>
    <button class="button" id="spinBtn">Spin</button>
    <div class="result" id="result">Result: â€”</div>

    <input id="wallet" placeholder="Solana wallet (optional)">
    <button class="button" onclick="connectPhantom()">Connect Phantom</button>

    <button class="button" onclick="shareX()">Share your win on X</button>
  </div>

  <!-- RIGHT -->
  <div class="logo-box">
    <img src="logo-rfx2.png" alt="RFX2">
    <p style="color:#b89000;font-weight:600">
      Hold your airdrops.<br>
      Accumulate. Support RFX2.
    </p>
  </div>

</div>

<script>
/* === DATA === */
const slices = [
  { label:"Happy", emoji:"ðŸ˜Š", weight:25 },
  { label:"Angry", emoji:"ðŸ˜¡", weight:25 },
  { label:"Motivated", emoji:"ðŸ”¥", weight:25 },
  { label:"Loved", emoji:"â¤ï¸", weight:20 },
  { label:"Airdrop", emoji:"ðŸ’Ž", weight:5 }
];

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const center = canvas.width/2;
const radius = center - 10;
let angle = 0;

/* === DRAW === */
function drawWheel() {
  const total = slices.reduce((a,b)=>a+b.weight,0);
  let start = 0;

  slices.forEach(s=>{
    const sliceAngle = (s.weight/total) * Math.PI*2;
    ctx.beginPath();
    ctx.moveTo(center,center);
    ctx.arc(center,center,radius,start,start+sliceAngle);
    ctx.fillStyle = "#6d4bd4";
    ctx.fill();
    ctx.strokeStyle="#f6c400";
    ctx.lineWidth=6;
    ctx.stroke();

    const mid = start + sliceAngle/2;
    ctx.save();
    ctx.translate(
      center + Math.cos(mid)*radius*0.6,
      center + Math.sin(mid)*radius*0.6
    );
    ctx.font="26px serif";
    ctx.fillText(s.emoji,-12,10);
    ctx.restore();

    start+=sliceAngle;
  });

  // pointer
  ctx.fillStyle="#6cf";
  ctx.beginPath();
  ctx.moveTo(center-10,10);
  ctx.lineTo(center+10,10);
  ctx.lineTo(center,30);
  ctx.fill();
}

drawWheel();

/* === SPIN === */
function spin() {
  const last = localStorage.getItem("lastSpin");
  if(last && Date.now()-last < 21600000){
    alert("Spin available every 6 hours.");
    return;
  }

  const total = slices.reduce((a,b)=>a+b.weight,0);
  let rand = Math.random()*total;
  let selected;

  for(const s of slices){
    rand -= s.weight;
    if(rand<=0){ selected=s; break;}
  }

  angle += Math.PI*6 + Math.random()*Math.PI*2;
  canvas.style.transition="transform 4s ease-out";
  canvas.style.transform=`rotate(${angle}rad)`;

  setTimeout(()=>{
    document.getElementById("result").innerText =
      "Result: " + selected.emoji + " " + selected.label;

    saveWinner(selected);
    localStorage.setItem("lastSpin",Date.now());
  },4000);
}

document.getElementById("spinBtn").onclick=spin;

/* === STORAGE === */
function saveWinner(res){
  const data = JSON.parse(localStorage.getItem("rfx2Wins")||"[]");
  data.push({
    time:new Date().toISOString(),
    wallet:document.getElementById("wallet").value || "anonymous",
    result:res.label
  });
  localStorage.setItem("rfx2Wins",JSON.stringify(data));
}

/* === PHANTOM === */
async function connectPhantom(){
  if(window.solana?.isPhantom){
    const r = await window.solana.connect();
    document.getElementById("wallet").value = r.publicKey.toString();
  } else {
    alert("Phantom not found");
  }
}

/* === SHARE === */
function shareX(){
  const text = encodeURIComponent(
    "I just played the RFX2 Community Spin ðŸŽ¡\nJoin the experiment ðŸ‘‡"
  );
  window.open("https://twitter.com/intent/tweet?text="+text,"_blank");
}

/* === ADMIN === */
if(location.search.includes("admin")){
  console.table(JSON.parse(localStorage.getItem("rfx2Wins")||"[]"));
}
</script>

</body>
</html>
