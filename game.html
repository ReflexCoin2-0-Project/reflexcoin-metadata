<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RFX2 Community Spin</title>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:radial-gradient(circle at top,#0b1220,#05080f);
  color:#fff;
}

.container{
  max-width:1200px;
  margin:auto;
  padding:40px 20px;
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:30px;
}

.card{
  background:linear-gradient(180deg,#0f1b34,#070c18);
  border-radius:18px;
  padding:30px;
}

h1{
  color:#f5c400;
  margin-top:0;
}

ul{
  padding-left:18px;
}

.wheel-card{
  display:flex;
  flex-direction:column;
  align-items:center;
}

.wheel-wrapper{
  position:relative;
  width:360px;
  height:360px;
}

canvas{
  width:360px;
  height:360px;
}

/* SETA EM BAIXO A APONTAR PARA O PR√âMIO */
.pointer{
  position:absolute;
  bottom:-20px;
  left:50%;
  transform:translateX(-50%) rotate(180deg);
  width:0;
  height:0;
  border-left:14px solid transparent;
  border-right:14px solid transparent;
  border-top:22px solid #4da3ff;
  z-index:10;
}

button{
  margin-top:14px;
  background:#f5c400;
  border:none;
  border-radius:999px;
  padding:12px 26px;
  font-size:15px;
  font-weight:bold;
  cursor:pointer;
}

input{
  margin-top:12px;
  width:90%;
  padding:10px;
  border-radius:999px;
  border:none;
  text-align:center;
}

.logo-card{
  background:#fff;
  color:#c9a227;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}

.logo-card img{
  width:140px;
}

.logo-card p{
  margin-top:14px;
  text-align:center;
  font-weight:bold;
}

/* MOBILE ‚Äì apenas centragem */
@media(max-width:900px){
  .container{
    grid-template-columns:1fr;
  }
}

/* ===== POP-UP AIRDROP ===== */
.modal-overlay{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.modal{
  background:linear-gradient(180deg,#0f1b34,#070c18);
  border-radius:18px;
  padding:28px 24px;
  max-width:360px;
  width:90%;
  text-align:center;
  box-shadow:0 0 40px rgba(0,0,0,0.6);
}

.modal h2{
  color:#f5c400;
  margin-top:0;
}

.modal p{
  font-size:14px;
  line-height:1.5;
  color:#e6e9f0;
}

.modal button{
  margin-top:18px;
  background:#f5c400;
  border:none;
  border-radius:999px;
  padding:10px 24px;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="container">

  <!-- LEFT -->
  <div class="card">
    <h1>üé° RFX2 Community Spin</h1>
    <p>Community-driven experiment built around emotion and participation.</p>
    <ul>
      <li>‚è± 1 spin every 6 hours</li>
      <li>üíé Airdrop slice included</li>
      <li>üéØ Equal probability for all emojis</li>
    </ul>
  </div>

  <!-- CENTER -->
  <div class="card wheel-card">

    <div class="wheel-wrapper">
      <div class="pointer"></div>
      <canvas id="wheel" width="360" height="360"></canvas>
    </div>

    <button onclick="spin()">Spin</button>

    <input id="walletInput" type="text" placeholder="Solana wallet (optional)">

    <button onclick="connectPhantom()">Connect Phantom</button>
    <button onclick="shareOnX()">Share your win on X</button>

    <div id="result" style="margin-top:10px;font-weight:bold;"></div>
  </div>

  <!-- RIGHT -->
  <div class="card logo-card">
    <img src="logo-rfx2.png" alt="RFX2">
    <p>Hold your airdrops.<br>Accumulate. Support RFX2.</p>
  </div>

</div>

<!-- POP-UP AIRDROP -->
<div class="modal-overlay" id="airdropModal">
  <div class="modal">
    <h2>üíé Airdrop unlocked</h2>
    <p>
      Your wallet is now <strong>eligible</strong> for a RFX2 airdrop.<br><br>
      Airdrops are distributed <strong>later in secure batches</strong>
      to avoid errors.<br><br>
      <strong>No SOL is ever taken</strong> from your wallet.
    </p>
    <button onclick="closeAirdropModal()">OK</button>
  </div>
</div>

<script>
/* ===== ROULETTE ===== */
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");

const slices = ["‚ù§Ô∏è","‚≠ê","üíé","üòä","üò°","üî•"];
const sliceAngle = (2 * Math.PI) / slices.length;
let rotation = 0;
let spinning = false;
let lastResult = null;

function drawWheel(){
  ctx.clearRect(0,0,360,360);

  slices.forEach((emoji,i)=>{
    const a = rotation + i * sliceAngle;

    ctx.beginPath();
    ctx.moveTo(180,180);
    ctx.arc(180,180,170,a,a + sliceAngle);
    ctx.closePath();

    ctx.fillStyle = i % 2 === 0 ? "#6d4bd4" : "#5b3fc4";
    ctx.fill();
    ctx.strokeStyle = "#f5c400";
    ctx.lineWidth = 3;
    ctx.stroke();

    ctx.save();
    ctx.translate(180,180);
    ctx.rotate(a + sliceAngle/2);
    ctx.textAlign = "center";
    ctx.font = "26px Arial";
    ctx.fillStyle = "#fff";
    ctx.fillText(emoji,100,10);
    ctx.restore();
  });
}

drawWheel();

function spin(){
  if(spinning) return;

  const lastSpin = localStorage.getItem("rfx2_last_spin");
  if(lastSpin && Date.now() - lastSpin < 6*60*60*1000){
    alert("Please wait 6 hours between spins.");
    return;
  }

  spinning = true;
  localStorage.setItem("rfx2_last_spin", Date.now());

  const winnerIndex = Math.floor(Math.random() * slices.length);

  const targetRotation =
    8 * Math.PI * 2 +
    (Math.PI * 2 - (winnerIndex * sliceAngle + sliceAngle / 2));

  const startRotation = rotation;
  const startTime = performance.now();
  const duration = 4000;

  function animate(t){
    const progress = Math.min((t - startTime) / duration, 1);
    const ease = 1 - Math.pow(1 - progress, 3);
    rotation = startRotation + (targetRotation - startRotation) * ease;
    drawWheel();

    if(progress < 1){
      requestAnimationFrame(animate);
    } else {
      rotation = targetRotation % (2 * Math.PI);
      spinning = false;
      lastResult = slices[winnerIndex];
      document.getElementById("result").innerText =
        "Result: " + lastResult;

      if(lastResult === "üíé"){
        openAirdropModal();
      }
    }
  }

  requestAnimationFrame(animate);
}

/* ===== PHANTOM ===== */
async function connectPhantom(){
  if(!window.solana || !window.solana.isPhantom){
    alert("Phantom Wallet not found.");
    return;
  }
  try{
    const res = await window.solana.connect();
    document.getElementById("walletInput").value =
      res.publicKey.toString();
  }catch(e){
    alert("Connection cancelled.");
  }
}

/* ===== SHARE X ===== */
function shareOnX(){
  if(!lastResult){
    alert("Spin first.");
    return;
  }

  const text =
    `I just played the RFX2 Community Spin üé°\n` +
    `Result: ${lastResult}\n\nTry it here üëá`;

  const url =
    "https://reflexcoin2-0-project.github.io/reflexcoin-metadata/game.html";

  const shareUrl =
    "https://twitter.com/intent/tweet?text=" +
    encodeURIComponent(text) +
    "&url=" +
    encodeURIComponent(url);

  window.open(shareUrl,"_blank");
}

/* ===== MODAL ===== */
function openAirdropModal(){
  document.getElementById("airdropModal").style.display = "flex";
}

function closeAirdropModal(){
  document.getElementById("airdropModal").style.display = "none";
}
</script>

</body>
</html>
