<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RFX2 Community Spin</title>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:radial-gradient(circle at top,#0b1220,#05080f);
  color:#fff;
}

.wrapper{
  max-width:1200px;
  margin:auto;
  padding:20px;
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:20px;
}

.card{
  background:linear-gradient(180deg,#0e1730,#070c18);
  border-radius:18px;
  padding:24px;
}

h1{
  color:#f5c400;
  margin-top:0;
}

ul{padding-left:18px}

/* wheel */
.wheel-box{
  display:flex;
  flex-direction:column;
  align-items:center;
}

.wheel-container{
  position:relative;
  width:320px;
  height:320px;
}

canvas{
  width:320px;
  height:320px;
}

/* ‚úÖ SETA NO MESMO S√çTIO ‚Äî BICO PARA CIMA */
.pointer{
  position:absolute;
  bottom:-14px;           /* mant√©m em baixo */
  left:50%;
  transform:translateX(-50%); /* sem rota√ß√£o */
  width:0;
  height:0;
  border-left:14px solid transparent;
  border-right:14px solid transparent;
  border-bottom:22px solid #5bbcff; /* bico para cima */
}

button{
  margin-top:18px;
  padding:12px 28px;
  border:none;
  border-radius:999px;
  background:#f5c400;
  font-weight:bold;
  cursor:pointer;
}

input{
  width:100%;
  margin-top:14px;
  padding:10px;
  border-radius:999px;
  border:none;
}

.result{
  margin-top:14px;
  font-size:18px;
}

.logo-card{
  background:#fff;
  color:#c8a100;
  text-align:center;
}

.logo-card img{
  max-width:140px;
}

@media(max-width:900px){
  .wrapper{
    grid-template-columns:1fr;
  }
}
</style>
</head>

<body>

<div class="wrapper">

  <div class="card">
    <h1>üé° RFX2 Community Spin</h1>
    <p>Community-driven experiment built around emotion and participation.</p>
    <ul>
      <li>‚è± 1 spin every 6 hours</li>
      <li>üíé Airdrop slice included</li>
      <li>üéØ Equal probability for all emojis</li>
    </ul>
  </div>

  <div class="card wheel-box">
    <div class="wheel-container">
      <canvas id="wheel" width="320" height="320"></canvas>
      <div class="pointer"></div>
    </div>

    <button onclick="spin()">Spin</button>
    <input id="wallet" placeholder="Solana wallet (optional)">
    <button onclick="connectPhantom()">Connect Phantom</button>
    <button onclick="shareX()">Share your win on X</button>
    <div class="result" id="result">Result: ‚Äî</div>
  </div>

  <div class="card logo-card">
    <img src="logo-rfx2.png" alt="RFX2">
    <p><strong>Save your airdrops.<br>Accumulate. Support RFX2.</strong></p>
  </div>

</div>

<script>
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');

const emojis = ['üî•','‚ù§Ô∏è','‚≠ê','üíé','üôÇ','üò°'];
const sliceCount = emojis.length;
const sliceAngle = (2*Math.PI)/sliceCount;

let currentRotation = 0;
let spinning = false;

function drawWheel(rotation=0){
  ctx.clearRect(0,0,320,320);
  ctx.save();
  ctx.translate(160,160);
  ctx.rotate(rotation);

  for(let i=0;i<sliceCount;i++){
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0,0,150,i*sliceAngle,(i+1)*sliceAngle);
    ctx.fillStyle = '#6b4dd6';
    ctx.fill();
    ctx.strokeStyle = '#f5c400';
    ctx.lineWidth = 3;
    ctx.stroke();

    ctx.save();
    ctx.rotate(i*sliceAngle + sliceAngle/2);
    ctx.textAlign='center';
    ctx.font='26px serif';
    ctx.fillStyle='#fff';
    ctx.fillText(emojis[i],90,10);
    ctx.restore();
  }
  ctx.restore();
}

drawWheel();

function spin(){
  if(spinning) return;
  spinning=true;

  const winnerIndex = Math.floor(Math.random()*sliceCount);

  const pointerAngle = Math.PI/2; // seta em baixo, a apontar para cima
  const targetAngle =
    pointerAngle - (winnerIndex*sliceAngle + sliceAngle/2);

  const spins = 5*2*Math.PI;
  const finalRotation = spins + targetAngle;

  let start=null;
  const duration=3500;

  function animate(ts){
    if(!start) start=ts;
    const p = Math.min((ts-start)/duration,1);
    const ease = 1-Math.pow(1-p,3);
    currentRotation = ease*finalRotation;
    drawWheel(currentRotation);
    if(p<1){
      requestAnimationFrame(animate);
    } else {
      spinning=false;
      document.getElementById('result').innerText =
        'Result: ' + emojis[winnerIndex];
    }
  }

  requestAnimationFrame(animate);
}

function connectPhantom(){
  if(window.solana && window.solana.isPhantom){
    window.solana.connect().then(r=>{
      document.getElementById('wallet').value =
        r.publicKey.toString();
    });
  } else alert('Phantom not found');
}

function shareX(){
  const text = encodeURIComponent(
    'I just spun the RFX2 Community Spin üé°'
  );
  window.open(
    'https://twitter.com/intent/tweet?text='+text,
    '_blank'
  );
}
</script>

</body>
</html>
