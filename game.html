<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RFX2 Community Spin</title>

<!-- =====================
  RFX2 COMMUNITY SPIN
  FRONTEND + BACKEND (Supabase)
  SINGLE FILE VERSION
===================== -->

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  margin: 0;
  background: radial-gradient(circle at top, #111a33, #050814);
  font-family: Arial, sans-serif;
  color: #fff;
}

.wrapper {
  max-width: 1400px;
  margin: auto;
  padding: 40px;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 40px;
  align-items: center;
}

.card {
  background: linear-gradient(180deg, #0f1730, #0a1022);
  border-radius: 18px;
  padding: 30px;
}

h1 { color: #f5c400; margin-top: 0; }

canvas { display:block; margin:auto; }

button {
  background:#f5c400;
  border:none;
  padding:14px 26px;
  border-radius:30px;
  font-weight:bold;
  cursor:pointer;
  margin-top:14px;
}

.logo-box {
  background:#fff;
  border-radius:18px;
  padding:30px;
  text-align:center;
}
.logo-box img { width:170px; }
.logo-box p { color:#c49a00; font-weight:bold; }

input {
  width:80%;
  padding:12px;
  border-radius:20px;
  border:none;
  margin-top:14px;
}

.result { margin-top:10px; font-size:18px; }
</style>
</head>
<body>

<div class="wrapper">

<!-- LEFT -->
<div class="card">
<h1>üé° RFX2 Community Spin</h1>
<p>Community-driven experiment around emotion, participation and attention.</p>
<ul>
<li>‚è±Ô∏è 1 spin every 6 hours</li>
<li>üíé Equal probability (airdrop included)</li>
<li>üëõ Wallet required for eligibility</li>
</ul>
</div>

<!-- CENTER -->
<div style="text-align:center">
<canvas id="wheel" width="420" height="420"></canvas>
<button onclick="spin()">Spin</button>
<div class="result" id="result">Result: ‚Äî</div>
<input id="wallet" placeholder="Solana wallet">
<button onclick="connectPhantom()">Connect Phantom</button>
<button onclick="shareWin()">Share your win on X</button>
</div>

<!-- RIGHT -->
<div class="logo-box">
<img src="logo-rfx2.png">
<p>Hold your airdrops. Support RFX2.</p>
</div>

</div>

<script>
// =====================
// SUPABASE CONFIG
// =====================
const supabase = supabase.createClient(
  "https://YOUR_PROJECT_ID.supabase.co",
  "YOUR_PUBLIC_ANON_KEY"
);

// =====================
// WHEEL CONFIG
// =====================
const slices = [
 {emoji:"üòä",label:"Happy"},
 {emoji:"üò°",label:"Angry"},
 {emoji:"üî•",label:"Motivated"},
 {emoji:"‚ù§Ô∏è",label:"Loved"},
 {emoji:"‚≠ê",label:"Star"},
 {emoji:"üíé",label:"Airdrop"}
];

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const cx=210, cy=210, r=170;
let rotation=0;
const angle=2*Math.PI/slices.length;

function draw(){
 ctx.clearRect(0,0,420,420);
 slices.forEach((s,i)=>{
  const a=rotation+i*angle;
  ctx.beginPath();
  ctx.moveTo(cx,cy);
  ctx.arc(cx,cy,r,a,a+angle);
  ctx.fillStyle=i%2?"#6b3fd6":"#1a2140";
  ctx.fill();
  const m=a+angle/2;
  ctx.font="32px serif";
  ctx.fillStyle="#fff";
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  ctx.fillText(s.emoji,cx+Math.cos(m)*r*0.65,cy+Math.sin(m)*r*0.65);
 });
 ctx.beginPath();ctx.arc(cx,cy,r,0,2*Math.PI);
 ctx.strokeStyle="#f5c400";ctx.lineWidth=8;ctx.stroke();
 ctx.fillStyle="#6bb6ff";
 ctx.beginPath();
 ctx.moveTo(cx,cy-r-12);
 ctx.lineTo(cx-12,cy-r+8);
 ctx.lineTo(cx+12,cy-r+8);
 ctx.fill();
}

draw();

// =====================
// SPIN LOGIC + BACKEND
// =====================
async function spin(){
 const wallet=document.getElementById("wallet").value.trim();
 if(!wallet){ alert("Wallet required"); return; }

 const {data:last}=await supabase
  .from("spins")
  .select("created_at")
  .eq("wallet",wallet)
  .order("created_at",{ascending:false})
  .limit(1);

 if(last?.length){
  const diff=Date.now()-new Date(last[0].created_at).getTime();
  if(diff<6*60*60*1000){ alert("Spin cooldown active"); return; }
 }

 const win=Math.floor(Math.random()*slices.length);
 const turns=6+Math.random()*4;
 const end=turns*2*Math.PI+(slices.length-win)*angle;
 const start=rotation;
 const t0=performance.now();

 function anim(t){
  const p=Math.min((t-t0)/2500,1);
  rotation=start+(end-start)*p;
  draw();
  if(p<1) requestAnimationFrame(anim);
  else finish(win,wallet);
 }
 requestAnimationFrame(anim);
}

async function finish(i,wallet){
 const res=slices[i];
 document.getElementById("result").innerText=
  "Result: "+res.emoji+" "+res.label;

 await supabase.from("spins").insert({
  wallet:wallet,
  result:res.label,
  is_airdrop:res.label==="Airdrop"
 });
}

// =====================
// PHANTOM
// =====================
async function connectPhantom(){
 if(!window.solana){ alert("Phantom not found"); return; }
 const r=await window.solana.connect();
 document.getElementById("wallet").value=r.publicKey.toString();
}

function shareWin(){
 window.open("https://twitter.com/intent/tweet?text="+
  encodeURIComponent("I just played the RFX2 Community Spin üé°"),"_blank");
}
</script>

<!-- =====================
SUPABASE TABLES

spins:
- id uuid
- wallet text
- result text
- is_airdrop boolean
- created_at timestamp
===================== -->

</body>
</html>
