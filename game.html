<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>RFX2 Community Spin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:radial-gradient(circle at top,#0b1220,#05080f);
  color:#fff;
}

.container{
  max-width:1200px;
  margin:auto;
  padding:30px;
  display:flex;
  gap:30px;
}

.card{
  background:linear-gradient(180deg,#0e1630,#080c18);
  border-radius:20px;
  padding:25px;
  flex:1;
}

h1{
  color:#f5c400;
  margin-top:0;
}

ul{
  padding-left:20px;
}

.center{
  text-align:center;
}

#wheelWrapper{
  position:relative;
  width:360px;
  height:360px;
  margin:0 auto;
}

#pointer{
  position:absolute;
  bottom:-18px;
  left:50%;
  transform:translateX(-50%);
  width:0;
  height:0;
  border-left:14px solid transparent;
  border-right:14px solid transparent;
  border-top:24px solid #4cc3ff;
}

canvas{
  display:block;
  margin:auto;
}

button{
  background:#f5c400;
  border:none;
  border-radius:999px;
  padding:12px 20px;
  font-weight:bold;
  cursor:pointer;
  margin-top:12px;
}

input{
  width:100%;
  padding:10px;
  border-radius:999px;
  border:none;
  margin-top:10px;
}

.result{
  margin-top:10px;
  font-weight:bold;
}

.logoBox{
  background:#fff;
  border-radius:20px;
  padding:25px;
  text-align:center;
  color:#c9a23a;
}

.logoBox img{
  width:120px;
}

/* Mobile only */
@media(max-width:900px){
  .container{
    flex-direction:column;
    align-items:center;
  }
  #wheelWrapper{
    width:300px;
    height:300px;
  }
}
</style>
</head>

<body>

<div class="container">

  <div class="card">
    <h1>ğŸ¡ Giro da Comunidade RFX2</h1>
    <p>Experimento conduzido pela comunidade, baseado em emoÃ§Ã£o e participaÃ§Ã£o.</p>
    <ul>
      <li>â± 1 giro a cada 6 horas</li>
      <li>ğŸ’ Fatia de airdrop incluÃ­da</li>
      <li>ğŸ¯ Probabilidade igual para todos os emojis</li>
    </ul>
  </div>

  <div class="card center">
    <div id="wheelWrapper">
      <canvas id="wheel" width="360" height="360"></canvas>
      <div id="pointer"></div>
    </div>

    <button id="spinBtn">Rodar</button>

    <input id="walletInput" placeholder="Carteira Solana (opcional)">

    <button onclick="connectPhantom()">Conectar Phantom</button>
    <button onclick="shareX()">Compartilhar vitÃ³ria no X</button>

    <div class="result" id="result">Resultado: â€”</div>
  </div>

  <div class="logoBox">
    <img src="logo-rfx2.png">
    <p><strong>Guarde seus airdrops.<br>Acumule. Apoie o RFX2.</strong></p>
  </div>

</div>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const size = canvas.width;
const center = size / 2;

const emojis = ["â¤ï¸","ğŸ”¥","ğŸ˜¡","ğŸ˜Š","â­","ğŸ’"];
const slices = emojis.length;
const sliceAngle = (Math.PI * 2) / slices;

let angle = 0;
let spinning = false;

function drawWheel(){
  ctx.clearRect(0,0,size,size);

  for(let i=0;i<slices;i++){
    const start = angle + i * sliceAngle;
    const end = start + sliceAngle;

    ctx.beginPath();
    ctx.moveTo(center,center);
    ctx.arc(center,center,center-6,start,end);
    ctx.closePath();
    ctx.fillStyle = "#6b4bd6";
    ctx.fill();
    ctx.strokeStyle = "#f5c400";
    ctx.lineWidth = 3;
    ctx.stroke();

    ctx.save();
    ctx.translate(center,center);
    ctx.rotate(start + sliceAngle/2);
    ctx.textAlign="right";
    ctx.font="28px Arial";
    ctx.fillText(emojis[i],center-40,10);
    ctx.restore();
  }
}

drawWheel();

document.getElementById("spinBtn").onclick = () => {
  if(spinning) return;

  const last = localStorage.getItem("lastSpin");
  if(last && Date.now() - last < 6*60*60*1000){
    alert("Aguarda 6 horas entre giros.");
    return;
  }

  spinning = true;
  localStorage.setItem("lastSpin",Date.now());

  const spins = Math.random()*10 + 10;
  const target = angle + spins * Math.PI*2 + Math.random()*sliceAngle;
  const start = angle;
  const duration = 4000;
  const startTime = performance.now();

  function animate(t){
    const p = Math.min((t-startTime)/duration,1);
    angle = start + (target-start)*easeOut(p);
    drawWheel();
    if(p<1){
      requestAnimationFrame(animate);
    }else{
      spinning=false;
      angle %= Math.PI*2;

      const index = Math.floor(
        ( (Math.PI*2 - angle + Math.PI/2) % (Math.PI*2) ) / sliceAngle
      );
      const result = emojis[index];
      document.getElementById("result").innerText = "Resultado: " + result;
    }
  }
  requestAnimationFrame(animate);
};

function easeOut(t){
  return 1-Math.pow(1-t,3);
}

function connectPhantom(){
  if(window.solana?.isPhantom){
    window.solana.connect().then(r=>{
      walletInput.value = r.publicKey.toString();
    });
  }else{
    alert("Phantom nÃ£o encontrado");
  }
}

function shareX(){
  const text = encodeURIComponent("Acabei de girar a roleta RFX2 ğŸ¡ğŸ’");
  window.open(`https://twitter.com/intent/tweet?text=${text}`,"_blank");
}
</script>

</body>
</html>
